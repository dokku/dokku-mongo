#!/usr/bin/env bash
export MONGO_IMAGE=${MONGO_IMAGE:="mongo"}
export MONGO_IMAGE_VERSION=${MONGO_IMAGE_VERSION:="3.4.9"}
export MONGO_ROOT=${MONGO_ROOT:="/var/lib/dokku/services/mongo"}
export MONGO_HOST_ROOT=${MONGO_HOST_ROOT:=$MONGO_ROOT}

export PLUGIN_COMMAND_PREFIX="mongo"
export PLUGIN_CONFIG_ROOT=${PLUGIN_CONFIG_ROOT:="$DOKKU_LIB_ROOT/config/$PLUGIN_COMMAND_PREFIX"}
export PLUGIN_DATA_ROOT=$MONGO_ROOT
export PLUGIN_DATA_HOST_ROOT=$MONGO_HOST_ROOT
export PLUGIN_DATASTORE_PORTS=(27017 27018 27019 28017)
export PLUGIN_DATASTORE_WAIT_PORT=27017
export PLUGIN_DEFAULT_ALIAS="MONGO"
export PLUGIN_DISABLE_PULL=${MONGO_DISABLE_PULL:=}
export PLUGIN_DISABLE_PULL_VARIABLE="MONGO_DISABLE_PULL"
export PLUGIN_ALT_ALIAS="DOKKU_MONGO"
export PLUGIN_IMAGE=$MONGO_IMAGE
export PLUGIN_IMAGE_VERSION=$MONGO_IMAGE_VERSION
export PLUGIN_SCHEME="mongodb"
export PLUGIN_SERVICE="MongoDB"
export PLUGIN_VARIABLE="MONGO"
export PLUGIN_BASE_PATH="$PLUGIN_PATH"
if [[ -n $DOKKU_API_VERSION ]]; then
  export PLUGIN_BASE_PATH="$PLUGIN_ENABLED_PATH"
fi

if [[ -d "$PLUGIN_DATA_ROOT/*" ]]; then
  rm -rf "${PLUGIN_DATA_ROOT:?}/*"
fi

export MONGO_CONFIG_OPTIONS=${MONGO_CONFIG_OPTIONS:=" --storageEngine wiredTiger --auth "}
